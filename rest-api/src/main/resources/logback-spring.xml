<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <property name="LOGS" value="./logs" />

    <appender name="Console"
            class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>
                %black(%d{ISO8601}) %highlight(%-5level) [%X{traceId:-},%X{spanId:-}] [%blue(%t)] %yellow(%C{1}): %msg%n%throwable
            </pattern>
        </encoder>
    </appender>

    <if condition='property("logging.file.enabled").equalsIgnoreCase("true")'>
        <then>
            <appender name="RollingFile"
                    class="ch.qos.logback.core.rolling.RollingFileAppender">
                <file>${LOGS}/sample-application.log</file>
                <encoder
                        class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
                    <Pattern>%d %p %C{1} [%X{traceId:-},%X{spanId:-}] [%t] %m%n</Pattern>
                </encoder>

                <rollingPolicy
                        class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
                    <!-- rollover daily and when the file reaches 1 MegaByte -->
                    <fileNamePattern>${LOGS}/archived/sample-application-%d{yyyy-MM-dd}.%i.log
                    </fileNamePattern>
                    <timeBasedFileNamingAndTriggeringPolicy
                            class="ch.qos.logback.core.rolling.SizeAndTimeBasedFileNamingAndTriggeringPolicy">
                        <maxFileSize>1MB</maxFileSize>
                    </timeBasedFileNamingAndTriggeringPolicy>
                </rollingPolicy>
            </appender>

            <root level="info">
                <appender-ref ref="RollingFile" />
                <appender-ref ref="Console" />
            </root>
        </then>
        <else>
            <root level="info">
                <appender-ref ref="Console" />
            </root>
        </else>
    </if>

</configuration>
