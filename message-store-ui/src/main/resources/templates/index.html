<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
    <head>
        <title>Message Store</title>

        <style>
            @import url(http://fonts.googleapis.com/css?family=Raleway);

            h2 {
                background-color: #FEFFED;
                padding: 30px 35px;
                margin: -10px -50px;
                text-align:center;
                border-radius: 10px 10px 0 0;
            }

            hr {
                margin: 10px -50px;
                border: 0;
                border-top: 1px solid #ccc;
                margin-bottom: 40px;
            }

            div.container {
                width: 900px;
                height: 610px;
                margin:35px auto;
                font-family: 'Raleway', sans-serif;
            }

            div.main{
                width: 300px;
                padding: 10px 50px 10px;
                border: 2px solid gray;
                border-radius: 10px;
                font-family: raleway;
                float:left;
                margin-top:60px;
            }

            input[type=text] {
                width: 100%;
                height: 40px;
                padding: 5px;
                margin-bottom: 25px;
                margin-top: 5px;
                border: 2px solid #ccc;
                color: #4f4f4f;
                font-size: 16px;
                border-radius: 5px;
            }

            label {
                color: #464646;
                text-shadow: 0 1px 0 #fff;
                font-size: 14px;
                font-weight: bold;
            }

            #get-button,#set-button {
                font-size: 16px;
                background: linear-gradient(#ffbc00 5%, #ffdd7f 100%);
                border: 1px solid #e5a900;
                color: #4E4D4B;
                font-weight: bold;
                cursor: pointer;
                width: 47.5%;
                border-radius: 5px;
                margin-bottom:10px;
                padding: 7px 0;
            }

            #get-button:hover, #set-button:hover {
                background: linear-gradient(#ffdd7f 5%, #ffbc00 100%);
            }

            #get-button, #set-button {
                margin-left: 10px;
            }
        </style>

        <script th:inline="javascript">
            var authToken = "[(${authToken})]";

            async function get() {
                var key = document.getElementById("message-key").value;
                const response = await fetch(
                  "[(${messageApiHost})]" + "/api/v1/messages/" + key,
                  {
                    method: "GET",
                    headers: {
                      "Accept": "application/json",
                      "Authorization": "Bearer " + authToken
                    }
                  }
                );
                const message = await response.json();

                document.getElementById("message-value").value = message.text;
            }
        </script>
    </head>
    <body>
        <div sec:authorize="!isAuthenticated()">
            <a th:href="@{/oauth2/authorization/okta}">Log In</a>
        </div>

        <div class="container" sec:authorize="isAuthenticated()">
            <div class="main">
                <form action="#" method="post" name="form_name" id="form_id" class="form_class" >
                    <h2>Message Store</h2>
                    <label>Key :</label>
                    <input type="text" id="message-key" placeholder="some key..." />

                    <label>Value :</label>
                    <input type="text" id="message-value" placeholder="value here..." />

                    <input type="button" id="get-button" value="Get" onclick="get()" />
                    <input type="button" id="set-button" value="Set" onclick="set()" />
                </form>
            </div>
        </div>

        <div sec:authorize="isAuthenticated()">
            <form name="logoutForm" th:action="@{/logout}" method="post">
                <button type="submit" value="Log out"/>
            </form>
        </div>
    </body>
</html>
